service: realty-bot
frameworkVersion: '3'
configValidationMode: error
useDotenv: true

provider:
    name: aws
    runtime: nodejs18.x
    region: ${env:AWS_REGION}
    versionFunctions: false
    environment:
        TG_BOT_TOKEN: ${env:TG_BOT_TOKEN}
        YA_TOKEN: ${env:YA_TOKEN}
        ADMIN_CHAT_ID: ${env:ADMIN_CHAT_ID}
        AWS_PROJECT_REGION: ${env:AWS_REGION}
        AWS_PROJECT_KEY: ${env:AWS_ACCESS_KEY_ID}
        AWS_PROJECT_SECRET: ${env:AWS_SECRET_ACCESS_KEY}

package:
    patterns:
        - '!src/**'
        - '!tests/**'

plugins:
    - serverless-offline
    - serverless-express

resources:
    - ${file(resources/settings-table.yml)}

functions:
    link:
        handler: dist/handler/link.handle
        events:
            -   http:
                    method: get
                    path: /link
    webhook:
        handler: dist/handler/webhook.handle
        timeout: 30
        events:
            -   http:
                    method: post
                    path: /webhook
    monitor:
        handler: dist/handler/monitor.handle
        timeout: 300
        events:
            -   schedule: rate(5 minutes)
            -   http:
                    method: get
                    path: /monitor